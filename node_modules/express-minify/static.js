var minify = require('./minify.js');
var express = require('express');
var app = express();

express.static.mime.define(
{
    'text/coffeescript':  ['coffee'],
    'text/less':          ['less'],
    'text/x-scss':        ['scss'],
    'text/stylus':        ['styl']
});

app.use(minify({
    cache: __dirname + '/cache'
}));
app.use(express.static(__dirname + '/examples/static'));
app.get('/1.js', function(req, res)
{
    
    res.setHeader('Content-Type', 'application/javascript');

    res.send('aaa();');
    //res.send('bbb');

    res.end("MyLib.remoteCall(" + JSON.stringify({
        'id': '1',
        'data': {
            'timestamp': new Date().getTime()
        }
    }, null, 4) + ");");
});
app.get('/2.js', function(req, res)
{
    res.setHeader('Content-Type', 'application/javascript');

    res.end("MyLib.remoteCall(" + JSON.stringify({
        'id': '1',
        'data': {
            'timestamp': new Date().getTime()
        }
    }, null, 4) + ");");
});
app.get('/3.min.js', function(req, res)
{
    res.end("MyLib.remoteCall(" + JSON.stringify({
        'id': '1',
        'data': {
            'timestamp': new Date().getTime()
        }
    }, null, 4) + ");");
});

app.listen(8080);